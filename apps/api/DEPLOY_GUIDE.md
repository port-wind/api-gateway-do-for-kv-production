# ğŸš€ æ™ºèƒ½éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æ™ºèƒ½éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰ç™»å½•çš„ Cloudflare è´¦å·ï¼Œå¹¶é€‰æ‹©å¯¹åº”çš„éƒ¨ç½²ç¯å¢ƒã€‚

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- âœ… é…ç½®å®Œå…¨åœ¨ `wrangler.toml` ä¸­ç®¡ç†
- âœ… è„šæœ¬é›¶ç¡¬ç¼–ç ï¼Œåªè´Ÿè´£é€‰æ‹©ç¯å¢ƒ
- âœ… æ˜“äºç»´æŠ¤å’Œæ‰©å±•

---

## ğŸ“ é…ç½®æ–‡ä»¶ç»“æ„

### `wrangler.toml` ç¯å¢ƒé…ç½®

```toml
# æµ‹è¯•ç¯å¢ƒï¼ˆé»˜è®¤ï¼‰
account_id = "625675bb221d602eccde58bb23facbfb"

# ç”Ÿäº§ç¯å¢ƒï¼ˆéœ€è¦å®Œæ•´é…ç½®æ‰€æœ‰ç»‘å®šï¼‰
[env.production]
account_id = "80e68ad465093681d7d893b6c122f9b8"

# ç”Ÿäº§ç¯å¢ƒçš„ KVã€DOã€vars ç­‰é…ç½®ï¼ˆæ³¨æ„ï¼šKV ID ä¸æµ‹è¯•ç¯å¢ƒä¸åŒï¼‰
[[env.production.kv_namespaces]]
binding = "API_GATEWAY_STORAGE"
id = "b91bfa214c174863b61931e77051e63a"  # ç”Ÿäº§ç¯å¢ƒç‹¬ç«‹çš„ KV

[env.production.durable_objects]
bindings = [...]

[env.production.vars]
DEFAULT_RATE_LIMIT = "60"
...
```

**æ³¨æ„**ï¼šç¯å¢ƒé…ç½®ä¸ä¼šç»§æ‰¿é¡¶å±‚é…ç½®ï¼Œéœ€è¦æ˜¾å¼å£°æ˜æ‰€æœ‰ç»‘å®šã€‚

### `deploy.sh` ç¯å¢ƒæ˜ å°„è§„åˆ™

```bash
portwind520@gmail.com  â†’  --env production  â†’  [env.production] (ç”Ÿäº§ç¯å¢ƒ)
å…¶ä»–è´¦å·              â†’  é»˜è®¤               â†’  æ ¹é…ç½® (æµ‹è¯•ç¯å¢ƒ)
```

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æ–¹å¼ä¸€ï¼šæ™ºèƒ½éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
cd apps/api

# äº¤äº’å¼éƒ¨ç½²ï¼ˆéœ€è¦æ‰‹åŠ¨ç¡®è®¤ï¼‰
./deploy.sh

# æˆ–ä½¿ç”¨ pnpm
pnpm deploy

# è‡ªåŠ¨ç¡®è®¤éƒ¨ç½²ï¼ˆç”¨äº CI/CDï¼‰
./deploy.sh -y
./deploy.sh --yes
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨æŒ‡å®šç¯å¢ƒ

```bash
# éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
wrangler deploy --env test

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
wrangler deploy
```

### æ–¹å¼ä¸‰ï¼šç›´æ¥ä½¿ç”¨ wrangler

```bash
pnpm deploy:direct
```

---

## ğŸ“Š å·¥ä½œæµç¨‹

```
å¼€å§‹éƒ¨ç½²
    â†“
æ£€æŸ¥å½“å‰ç™»å½•è´¦å·
    â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  portwind520@    â”‚    å…¶ä»–è´¦å·      â”‚
  â”‚  gmail.com       â”‚                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                    â†“
  wrangler deploy      wrangler deploy
     --env test           (é»˜è®¤ç¯å¢ƒ)
         â†“                    â†“
    ä½¿ç”¨ [env.test]      ä½¿ç”¨æ ¹é…ç½®
    Account ID:          Account ID:
    80e68ad4...          625675b...
         â†“                    â†“
       å®Œæˆ                 å®Œæˆ
```

---

## ğŸ¨ æ‰§è¡Œç¤ºä¾‹

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼ˆäº¤äº’å¼ï¼‰

```bash
$ ./deploy.sh

ğŸ” æ£€æŸ¥å½“å‰ç™»å½•è´¦å·...
ğŸ“§ å½“å‰ç™»å½•è´¦å·: portwind520@gmail.com

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“¦ å³å°†éƒ¨ç½²åˆ°ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ç¯å¢ƒ:       ğŸŸ¢ ç”Ÿäº§ç¯å¢ƒ (Production)
  è´¦å·:       portwind520@gmail.com
  Account ID: 80e68ad465093681d7d893b6c122f9b8
  é…ç½®æ¥æº:   wrangler.toml [env.production]
  éƒ¨ç½²å‘½ä»¤:   wrangler deploy --env production
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ ç¡®è®¤éƒ¨ç½²åˆ°æ­¤ç¯å¢ƒå—ï¼Ÿ(y/N): y

ğŸš€ å¼€å§‹éƒ¨ç½²...

[wrangler éƒ¨ç½²è¾“å‡º...]

âœ… éƒ¨ç½²å®Œæˆï¼
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼ˆè‡ªåŠ¨ç¡®è®¤ï¼‰

```bash
$ ./deploy.sh -y

ğŸ” æ£€æŸ¥å½“å‰ç™»å½•è´¦å·...
ğŸ“§ å½“å‰ç™»å½•è´¦å·: portwind520@gmail.com

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“¦ å³å°†éƒ¨ç½²åˆ°ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ç¯å¢ƒ:       ğŸŸ¢ ç”Ÿäº§ç¯å¢ƒ (Production)
  è´¦å·:       portwind520@gmail.com
  Account ID: 80e68ad465093681d7d893b6c122f9b8
  é…ç½®æ¥æº:   wrangler.toml [env.production]
  éƒ¨ç½²å‘½ä»¤:   wrangler deploy --env production
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… è‡ªåŠ¨ç¡®è®¤æ¨¡å¼ï¼Œè·³è¿‡ç¡®è®¤æ­¥éª¤

ğŸš€ å¼€å§‹éƒ¨ç½²...

[wrangler éƒ¨ç½²è¾“å‡º...]

âœ… éƒ¨ç½²å®Œæˆï¼
```

### æµ‹è¯•ç¯å¢ƒéƒ¨ç½²

```bash
$ ./deploy.sh

ğŸ” æ£€æŸ¥å½“å‰ç™»å½•è´¦å·...
ğŸ“§ å½“å‰ç™»å½•è´¦å·: test@example.com

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“¦ å³å°†éƒ¨ç½²åˆ°ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ç¯å¢ƒ:       ğŸŸ¡ æµ‹è¯•ç¯å¢ƒ (Test)
  è´¦å·:       test@example.com
  Account ID: 625675bb221d602eccde58bb23facbfb
  é…ç½®æ¥æº:   wrangler.toml (æ ¹é…ç½®)
  éƒ¨ç½²å‘½ä»¤:   wrangler deploy
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ ç¡®è®¤éƒ¨ç½²åˆ°æ­¤ç¯å¢ƒå—ï¼Ÿ(y/N): y

ğŸš€ å¼€å§‹éƒ¨ç½²...

[wrangler éƒ¨ç½²è¾“å‡º...]

âœ… éƒ¨ç½²å®Œæˆï¼
```

### å–æ¶ˆéƒ¨ç½²

```bash
$ ./deploy.sh

ğŸ” æ£€æŸ¥å½“å‰ç™»å½•è´¦å·...
ğŸ“§ å½“å‰ç™»å½•è´¦å·: test@example.com

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“¦ å³å°†éƒ¨ç½²åˆ°ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ç¯å¢ƒ:       ğŸŸ¡ æµ‹è¯•ç¯å¢ƒ (Test)
  è´¦å·:       test@example.com
  Account ID: 625675bb221d602eccde58bb23facbfb
  é…ç½®æ¥æº:   wrangler.toml (æ ¹é…ç½®)
  éƒ¨ç½²å‘½ä»¤:   wrangler deploy
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ ç¡®è®¤éƒ¨ç½²åˆ°æ­¤ç¯å¢ƒå—ï¼Ÿ(y/N): n

âŒ éƒ¨ç½²å·²å–æ¶ˆ
```

---

## âš™ï¸ é…ç½®ç®¡ç†

### æ·»åŠ æ–°ç¯å¢ƒ

ç¼–è¾‘ `wrangler.toml`ï¼š

```toml
# æ·»åŠ é¢„å‘å¸ƒç¯å¢ƒ
[env.staging]
account_id = "your-staging-account-id"
```

ç¼–è¾‘ `deploy.sh`ï¼Œæ·»åŠ è´¦å·æ˜ å°„ï¼š

```bash
elif [ "$CURRENT_EMAIL" = "staging@example.com" ]; then
    ENV_NAME="ğŸŸ  é¢„å‘å¸ƒç¯å¢ƒ (Staging)"
    ENV_FLAG="--env staging"
    CONFIG_SOURCE="wrangler.toml [env.staging]"
    ACCOUNT_ID="your-staging-account-id"
```

### ä¿®æ”¹è´¦å·æ˜ å°„

åªéœ€ä¿®æ”¹ `deploy.sh` ä¸­çš„é‚®ç®±åˆ¤æ–­é€»è¾‘ï¼Œæ— éœ€ä¿®æ”¹é…ç½®ã€‚

---

## ğŸ“¦ ç¯å¢ƒé…ç½®è¯´æ˜

| ç¯å¢ƒ | é…ç½®ä½ç½® | Account ID | è§¦å‘è´¦å· |
|------|---------|-----------|---------|
| ğŸŸ¢ **Production** | `[env.production]` | `80e68ad4...` | `portwind520@gmail.com` |
| ğŸŸ¡ **Test** | æ ¹é…ç½® | `625675bb...` | é™¤ç”Ÿäº§è´¦å·å¤–çš„æ‰€æœ‰è´¦å· |

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæœªæ£€æµ‹åˆ°ç™»å½•è´¦å·

**é”™è¯¯ä¿¡æ¯**:
```
âŒ é”™è¯¯ï¼šæœªç™»å½• Cloudflare è´¦å·
è¯·å…ˆè¿è¡Œ: wrangler login
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
wrangler login
```

### é—®é¢˜ï¼šéƒ¨ç½²åˆ°é”™è¯¯çš„ç¯å¢ƒ

**æ£€æŸ¥æ­¥éª¤**:
1. ç¡®è®¤å½“å‰ç™»å½•è´¦å·ï¼š
   ```bash
   wrangler whoami
   ```
2. æŸ¥çœ‹è„šæœ¬è¾“å‡ºçš„ç¯å¢ƒä¿¡æ¯
3. æ£€æŸ¥ `deploy.sh` ä¸­çš„è´¦å·æ˜ å°„è§„åˆ™

### é—®é¢˜ï¼šéœ€è¦æ‰‹åŠ¨æŒ‡å®šç¯å¢ƒ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç»•è¿‡æ™ºèƒ½æ£€æµ‹ï¼Œæ‰‹åŠ¨æŒ‡å®šç¯å¢ƒ
wrangler deploy --env test
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. è´¦å·ç®¡ç†
- ä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„ Cloudflare è´¦å·
- åœ¨ `deploy.sh` ä¸­é…ç½®è´¦å·åˆ°ç¯å¢ƒçš„æ˜ å°„

### 2. é…ç½®ç®¡ç†
- æ‰€æœ‰ç¯å¢ƒé…ç½®é›†ä¸­åœ¨ `wrangler.toml`
- è„šæœ¬åªè´Ÿè´£é€‰æ‹©ï¼Œä¸åŒ…å«é…ç½®ç»†èŠ‚
- ä¾¿äºå®¡æŸ¥å’Œç‰ˆæœ¬æ§åˆ¶

### 3. åˆ‡æ¢ç¯å¢ƒ
```bash
# åˆ‡æ¢åˆ°æµ‹è¯•ç¯å¢ƒ
wrangler logout
wrangler login  # ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•

# åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ
wrangler logout
wrangler login  # ä½¿ç”¨ç”Ÿäº§è´¦å·ç™»å½•
```

### 4. è‡ªåŠ¨ç¡®è®¤éƒ¨ç½²ï¼ˆCI/CD åœºæ™¯ï¼‰
```bash
# ä½¿ç”¨ -y æˆ– --yes è·³è¿‡ç¡®è®¤æ­¥éª¤
./deploy.sh -y
./deploy.sh --yes

# åœ¨ CI/CD ä¸­ä½¿ç”¨
pnpm deploy -- -y
```

### 5. ä¼ é€’é¢å¤–å‚æ•°
```bash
# ä¼ é€’ wrangler å‚æ•°
./deploy.sh --dry-run
./deploy.sh -y --dry-run

# æŸ¥çœ‹å¸®åŠ©
wrangler deploy --help
```

---

## ğŸ¯ ä¸æ—§æ–¹æ¡ˆå¯¹æ¯”

| æ–¹é¢ | æ—§æ–¹æ¡ˆï¼ˆç¡¬ç¼–ç ï¼‰ | æ–°æ–¹æ¡ˆï¼ˆé…ç½®åŒ–ï¼‰ |
|-----|----------------|----------------|
| é…ç½®ä½ç½® | è„šæœ¬ä¸­ç¡¬ç¼–ç  | `wrangler.toml` é›†ä¸­ç®¡ç† |
| ç»´æŠ¤æ€§ | éœ€ä¿®æ”¹è„šæœ¬ä»£ç  | åªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ |
| æ‰©å±•æ€§ | æ·»åŠ ç¯å¢ƒéœ€æ”¹ä»£ç  | æ·»åŠ ç¯å¢ƒåªéœ€åŠ é…ç½® |
| å¯è¯»æ€§ | åˆ†æ•£åœ¨è„šæœ¬ä¸­ | é…ç½®ä¸€ç›®äº†ç„¶ |
| éƒ¨ç½²è¿‡ç¨‹ | ä¸´æ—¶ä¿®æ”¹+æ¢å¤ | ç›´æ¥ä½¿ç”¨ç¯å¢ƒå‚æ•° |
| Git å‹å¥½ | éœ€è¦æ¢å¤æœºåˆ¶ | åŸç”Ÿæ”¯æŒï¼Œæ— éœ€æ¢å¤ |

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `deploy.sh` - æ™ºèƒ½éƒ¨ç½²è„šæœ¬ï¼ˆè´Ÿè´£é€‰æ‹©ç¯å¢ƒï¼‰
- `wrangler.toml` - ç¯å¢ƒé…ç½®ï¼ˆåŒ…å«æ‰€æœ‰é…ç½®ï¼‰
- `package.json` - npm è„šæœ¬é…ç½®

---

## ğŸ”— Wrangler ç¯å¢ƒæ–‡æ¡£

æ›´å¤šå…³äºç¯å¢ƒé…ç½®çš„ä¿¡æ¯ï¼Œè¯·æŸ¥é˜…ï¼š
https://developers.cloudflare.com/workers/wrangler/configuration/#environments

---

**Happy Deploying! ğŸ‰**
