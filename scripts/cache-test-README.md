# ç¼“å­˜æµ‹è¯•å¥—ä»¶

è¿™æ˜¯ä¸€å¥—å®Œæ•´çš„ POST è¯·æ±‚ç¼“å­˜æµ‹è¯•å·¥å…·ï¼Œç”¨äºéªŒè¯ API ç½‘å…³çš„ç¼“å­˜åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- âœ… POST è¯·æ±‚ç¼“å­˜æœºåˆ¶
- â±ï¸ TTL (ç”Ÿå­˜æ—¶é—´) è¿‡æœŸæµ‹è¯•  
- ğŸ“Š ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡
- ğŸ¯ åç«¯è¯·æ±‚æ•°é‡éªŒè¯
- ğŸ“‹ è¯¦ç»†æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨ API ç½‘å…³
```bash
cd apps/api
npm run dev
```

### 2. é…ç½®æµ‹è¯•ç¯å¢ƒ
```bash
./scripts/setup-cache-test.sh setup
```

### 3. æ‰§è¡Œç¼“å­˜æµ‹è¯•
```bash
./scripts/test-cache-post.sh
```

### 4. ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
```bash
node scripts/cache-test-report.js
```

## ğŸ“ æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | åŠŸèƒ½ | ç”¨é€” |
|------|------|------|
| `mock-backend-server.js` | åç«¯æ¨¡æ‹ŸæœåŠ¡å™¨ | è®°å½•å®é™…åˆ°è¾¾åç«¯çš„è¯·æ±‚æ•°ï¼ŒéªŒè¯ç¼“å­˜æ•ˆæœ |
| `test-cache-post.sh` | ç¼“å­˜æµ‹è¯•è„šæœ¬ | æ‰§è¡Œ 100 ä¸ª POST è¯·æ±‚ï¼Œæµ‹è¯•ç¼“å­˜è¡Œä¸º |
| `cache-test-report.js` | æŠ¥å‘Šç”Ÿæˆå™¨ | è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹ï¼Œç”Ÿæˆè¯¦ç»†åˆ†ææŠ¥å‘Š |
| `setup-cache-test.sh` | ç¯å¢ƒé…ç½®è„šæœ¬ | é…ç½®ä»£ç†è·¯ç”±å’Œç¼“å­˜è®¾ç½® |

## ğŸ”§ è¯¦ç»†ä½¿ç”¨è¯´æ˜

### 1. åç«¯æ¨¡æ‹ŸæœåŠ¡å™¨

**å¯åŠ¨æœåŠ¡å™¨ï¼š**
```bash
node scripts/mock-backend-server.js
```

**æœåŠ¡ç«¯ç‚¹ï¼š**
- `http://localhost:3001/api/test` - æµ‹è¯•æ¥å£
- `http://localhost:3001/stats` - è·å–è¯·æ±‚ç»Ÿè®¡
- `http://localhost:3001/reset` - é‡ç½®ç»Ÿè®¡æ•°æ®

### 2. ç¯å¢ƒé…ç½®è„šæœ¬

**é…ç½®æµ‹è¯•ç¯å¢ƒï¼š**
```bash
./scripts/setup-cache-test.sh setup
```

**æ¸…ç†æµ‹è¯•é…ç½®ï¼š**
```bash
./scripts/setup-cache-test.sh cleanup
```

**å…¶ä»–æ“ä½œï¼š**
```bash
./scripts/setup-cache-test.sh start-backend   # å¯åŠ¨åç«¯æœåŠ¡å™¨
./scripts/setup-cache-test.sh stop-backend    # åœæ­¢åç«¯æœåŠ¡å™¨
./scripts/setup-cache-test.sh verify          # éªŒè¯é…ç½®
./scripts/setup-cache-test.sh show            # æ˜¾ç¤ºé…ç½®ä¿¡æ¯
```

### 3. ç¼“å­˜æµ‹è¯•è„šæœ¬

**åŸºæœ¬ç”¨æ³•ï¼š**
```bash
./scripts/test-cache-post.sh [GATEWAY_URL]
```

**æµ‹è¯•æµç¨‹ï¼š**
1. å‘é€å‰ 50 ä¸ªè¯·æ±‚ï¼ˆç¼“å­˜å»ºç«‹ + å‘½ä¸­æµ‹è¯•ï¼‰
2. ç­‰å¾… 61 ç§’è®©ç¼“å­˜è¿‡æœŸ
3. å‘é€å 50 ä¸ªè¯·æ±‚ï¼ˆç¼“å­˜é‡å»º + å‘½ä¸­æµ‹è¯•ï¼‰
4. ç»Ÿè®¡å’Œåˆ†æç»“æœ

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
=== POST è¯·æ±‚ç¼“å­˜æµ‹è¯• ===
ğŸ¯ æµ‹è¯•ç›®æ ‡:
  â€¢ éªŒè¯ POST è¯·æ±‚ç¼“å­˜åŠŸèƒ½
  â€¢ æµ‹è¯• 60 ç§’ TTL è¿‡æœŸæœºåˆ¶
  â€¢ ç»Ÿè®¡ 100 ä¸ªè¯·æ±‚çš„ç¼“å­˜æ•ˆæœ

ğŸ“Š è¯·æ±‚ç»Ÿè®¡:
  â€¢ æ€»è¯·æ±‚æ•°:     100
  â€¢ ç¼“å­˜å‘½ä¸­:     98 (98%)
  â€¢ ç¼“å­˜æœªå‘½ä¸­:   2
  â€¢ å¹³å‡å“åº”æ—¶é—´: 25ms

ğŸ¯ åç«¯ç»Ÿè®¡:
  â€¢ æ–°å¢è¯·æ±‚æ•°:   2
  â€¢ ç¼“å­˜æœ‰æ•ˆæ€§:   98%
```

### 4. è‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆå™¨

**æ‰§è¡Œå®Œæ•´æµ‹è¯•ï¼š**
```bash
node scripts/cache-test-report.js
```

**ç”Ÿæˆçš„æŠ¥å‘Šï¼š**
- `test-reports/cache-test-report-[timestamp].json` - JSON æ ¼å¼è¯¦ç»†æŠ¥å‘Š
- `test-reports/cache-test-report-[timestamp].txt` - æ–‡æœ¬æ ¼å¼å¯è¯»æŠ¥å‘Š

**æŠ¥å‘Šå†…å®¹åŒ…æ‹¬ï¼š**
- æœåŠ¡çŠ¶æ€æ£€æŸ¥
- è¯¦ç»†è¯·æ±‚ç»Ÿè®¡
- æ€§èƒ½åˆ†æè¯„çº§
- ä¼˜åŒ–å»ºè®®

## ğŸ“Š æµ‹è¯•ç»“æœè§£è¯»

### ç†æƒ³ç»“æœ
- âœ… **åç«¯è¯·æ±‚æ•°**: â‰¤ 3 ä¸ªï¼ˆä»…åœ¨ç¼“å­˜å»ºç«‹æ—¶ï¼‰
- âœ… **ç¼“å­˜å‘½ä¸­ç‡**: â‰¥ 95%
- âœ… **å¹³å‡å“åº”æ—¶é—´**: < 100ms
- âœ… **ç¼“å­˜æœ‰æ•ˆæ€§**: â‰¥ 95%

### ç»“æœåˆ†æ
| æŒ‡æ ‡ | ä¼˜ç§€ | è‰¯å¥½ | ä¸€èˆ¬ | è¾ƒå·® |
|------|------|------|------|------|
| ç¼“å­˜æœ‰æ•ˆæ€§ | >95% | >85% | >70% | â‰¤70% |
| ç¼“å­˜å‘½ä¸­ç‡ | >95% | >80% | >60% | â‰¤60% |
| å“åº”æ—¶é—´ | <50ms | <100ms | <200ms | â‰¥200ms |

### ç¼“å­˜çŠ¶æ€è¯´æ˜
- **HIT**: ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥ä»ç¼“å­˜è¿”å›
- **MISS**: ç¼“å­˜æœªå‘½ä¸­ï¼Œä»åç«¯è·å–å¹¶å»ºç«‹ç¼“å­˜
- **STALE**: ç¼“å­˜è¿‡æœŸï¼Œè¿”å›è¿‡æœŸæ•°æ®å¹¶åå°æ›´æ–°

## ğŸ” æ•…éšœæ’é™¤

### ç½‘å…³è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ç½‘å…³æ˜¯å¦è¿è¡Œ
curl http://localhost:8787/health

# å¯åŠ¨ç½‘å…³ (åœ¨ apps/api ç›®å½•ä¸‹)
npm run dev
```

### åç«¯æœåŠ¡å™¨å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
lsof -i :3001

# æ‰‹åŠ¨å¯åŠ¨åç«¯æœåŠ¡å™¨
node scripts/mock-backend-server.js
```

### ç¼“å­˜é…ç½®ä¸ç”Ÿæ•ˆ
```bash
# é‡æ–°é…ç½®æµ‹è¯•ç¯å¢ƒ
./scripts/setup-cache-test.sh cleanup
./scripts/setup-cache-test.sh setup

# éªŒè¯é…ç½®
./scripts/setup-cache-test.sh verify
```

### æµ‹è¯•ç»“æœå¼‚å¸¸
1. **åç«¯è¯·æ±‚æ•°è¿‡å¤š**: æ£€æŸ¥ç¼“å­˜é…ç½®æ˜¯å¦æ­£ç¡®
2. **å‘½ä¸­ç‡è¿‡ä½**: éªŒè¯ç¼“å­˜ä¸­é—´ä»¶æ˜¯å¦æ­£å¸¸å·¥ä½œ
3. **å“åº”æ—¶é—´è¿‡é•¿**: æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿå’Œç½‘å…³æ€§èƒ½

## ğŸ“ æµ‹è¯•åœºæ™¯æ‰©å±•

### ä¿®æ”¹ç¼“å­˜ TTL
ç¼–è¾‘æµ‹è¯•è„šæœ¬ä¸­çš„ `CACHE_TTL` å˜é‡ï¼š
```bash
# åœ¨ test-cache-post.sh ä¸­
CACHE_TTL=120  # æ”¹ä¸º 120 ç§’
```

### ä¿®æ”¹æµ‹è¯•è¯·æ±‚æ•°
```bash
# åœ¨ test-cache-post.sh ä¸­  
TOTAL_REQUESTS=200  # æ”¹ä¸º 200 ä¸ªè¯·æ±‚
```

### è‡ªå®šä¹‰æµ‹è¯•è·¯å¾„
```bash
# åœ¨ setup-cache-test.sh ä¸­
TEST_PATH="/api/custom-test"
```

## ğŸ§ª é«˜çº§ç”¨æ³•

### å¹¶å‘æµ‹è¯•
```bash
# å¯åŠ¨å¤šä¸ªæµ‹è¯•è¿›ç¨‹ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
for i in {1..3}; do
  ./scripts/test-cache-post.sh &
done
wait
```

### æ€§èƒ½åŸºå‡†æµ‹è¯•
```bash
# è¿è¡Œå¤šè½®æµ‹è¯•è¿›è¡Œæ€§èƒ½å¯¹æ¯”
for round in {1..5}; do
  echo "=== ç¬¬ $round è½®æµ‹è¯• ==="
  node scripts/cache-test-report.js
  sleep 10
done
```

### ç›‘æ§åç«¯è¯·æ±‚
```bash
# å®æ—¶ç›‘æ§åç«¯è¯·æ±‚
while true; do
  curl -s http://localhost:3001/stats | jq '.totalRequests'
  sleep 1
done
```

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜ç­–ç•¥ä¼˜åŒ–**
   - æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ TTL
   - è€ƒè™‘ä½¿ç”¨ Stale-While-Revalidate ç­–ç•¥
   - å®ç°ç¼“å­˜é¢„çƒ­æœºåˆ¶

2. **æ€§èƒ½ç›‘æ§**
   - å®šæœŸè¿è¡Œç¼“å­˜æµ‹è¯•
   - ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡è¶‹åŠ¿
   - åˆ†æçƒ­ç‚¹æ•°æ®è®¿é—®æ¨¡å¼

3. **å®¹é”™å¤„ç†**
   - å®ç°ç¼“å­˜é™çº§æœºåˆ¶
   - æ·»åŠ ç¼“å­˜å‡»ç©¿ä¿æŠ¤
   - ä¼˜åŒ–ç¼“å­˜æ›´æ–°ç­–ç•¥

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚éœ€å¸®åŠ©æˆ–æŠ¥å‘Šé—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥æµ‹è¯•æ—¥å¿—è¾“å‡º
2. æŸ¥çœ‹ç”Ÿæˆçš„è¯¦ç»†æŠ¥å‘Š
3. éªŒè¯ç½‘å…³å’Œåç«¯æœåŠ¡çŠ¶æ€
4. æä¾›ç›¸å…³é”™è¯¯ä¿¡æ¯

---

## ğŸ“œ è®¸å¯è¯

æœ¬æµ‹è¯•å¥—ä»¶éµå¾ªé¡¹ç›®çš„å¼€æºè®¸å¯è¯ã€‚