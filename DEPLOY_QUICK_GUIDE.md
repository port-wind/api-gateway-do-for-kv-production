# å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸš€ æ¨èçš„éƒ¨ç½²æ–¹å¼

### æ–¹å¼ 1ï¼šé¦–æ¬¡éƒ¨ç½²æˆ–å®Œæ•´éƒ¨ç½²ï¼ˆæ…¢ä½†å®Œæ•´ï¼‰

```bash
# å®‰è£…ä¾èµ– + æ„å»º + éƒ¨ç½²ï¼ˆéœ€è¦ 3-5 åˆ†é’Ÿï¼‰
pnpm run deploy
```

### æ–¹å¼ 2ï¼šå¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨èï¼Œä»…éœ€ 10-30 ç§’ï¼‰âš¡

```bash
# ç¬¬ä¸€æ­¥ï¼šæœ¬åœ°æ„å»ºå‰ç«¯ï¼ˆä¸€æ¬¡æ€§ï¼Œçº¦ 1-2 åˆ†é’Ÿï¼‰
pnpm --filter @gateway/web build

# ç¬¬äºŒæ­¥ï¼šå¿«é€Ÿéƒ¨ç½²ï¼ˆè·³è¿‡æ„å»ºï¼Œçº¦ 10-30 ç§’ï¼‰
pnpm run deploy:web:fast
```

### æ–¹å¼ 3ï¼šä»…é‡æ–°éƒ¨ç½²å‰ç«¯ï¼ˆå·²æ„å»ºè¿‡ï¼‰

```bash
# å¦‚æœ dist ç›®å½•å·²å­˜åœ¨ï¼Œç›´æ¥éƒ¨ç½²ï¼ˆçº¦ 10-30 ç§’ï¼‰
pnpm run deploy:web:skip-build
```

## ğŸ“¦ å¯ç”¨çš„éƒ¨ç½²å‘½ä»¤

### å®Œæ•´éƒ¨ç½²

| å‘½ä»¤ | è¯´æ˜ | è€—æ—¶ |
|------|------|------|
| `pnpm run deploy` | API + Web å¹¶è¡Œéƒ¨ç½²ï¼ˆå®Œæ•´æµç¨‹ï¼‰ | ~3-5 åˆ†é’Ÿ |
| `pnpm run deploy:api` | ä»…éƒ¨ç½² API (Cloudflare Worker) | ~30-60 ç§’ |
| `pnpm run deploy:web` | ä»…éƒ¨ç½² Webï¼ˆåŒ…å«æ„å»ºï¼‰ | ~2-3 åˆ†é’Ÿ |

### å¿«é€Ÿéƒ¨ç½²ï¼ˆè·³è¿‡æ„å»ºï¼‰âš¡

| å‘½ä»¤ | è¯´æ˜ | è€—æ—¶ |
|------|------|------|
| `pnpm run deploy:web:fast` | å¿«é€Ÿéƒ¨ç½² Webï¼ˆè·³è¿‡å®‰è£…å’Œæ„å»ºï¼‰ | ~10-30 ç§’ |
| `pnpm run deploy:web:skip-build` | éƒ¨ç½² Webï¼ˆè·³è¿‡æ„å»ºï¼‰ | ~30-60 ç§’ |

### æœ¬åœ°æ„å»ºå’Œè¿è¡Œ

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `pnpm run build:197` | æ„å»ºå¹¶åœ¨æœ¬åœ° 8197 ç«¯å£è¿è¡Œ |
| `pnpm run build:serve` | æ„å»ºå¹¶åœ¨æœ¬åœ° 14289 ç«¯å£è¿è¡Œ |

## ğŸ” å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆ `pnpm run deploy` ä¼šæŠ¥ "index.html ä¸å­˜åœ¨"ï¼Ÿ

**A:** è¿™æ˜¯å› ä¸ºå‰ç«¯è¿˜æ²¡æœ‰æ„å»ºã€‚è§£å†³æ–¹æ¡ˆï¼š

```bash
# æ–¹æ¡ˆ 1ï¼šå…ˆæ„å»ºå†éƒ¨ç½²
pnpm --filter @gateway/web build
pnpm run deploy:web:fast

# æ–¹æ¡ˆ 2ï¼šä½¿ç”¨å®Œæ•´éƒ¨ç½²å‘½ä»¤ï¼ˆä¼šè‡ªåŠ¨æ„å»ºï¼‰
pnpm run deploy:web
```

### Q: å¦‚ä½•åŠ é€Ÿéƒ¨ç½²ï¼Ÿ

**A:** ä½¿ç”¨å¿«é€Ÿéƒ¨ç½²æ¨¡å¼ï¼š

1. **æœ¬åœ°å…ˆæ„å»º**ï¼ˆå¼€å‘æ—¶åªéœ€æ„å»ºä¸€æ¬¡ï¼‰ï¼š
   ```bash
   pnpm --filter @gateway/web build
   ```

2. **æ¯æ¬¡éƒ¨ç½²ç”¨å¿«é€Ÿæ¨¡å¼**ï¼š
   ```bash
   pnpm run deploy:web:fast
   ```

### Q: Jenkins éƒ¨ç½²å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** ç¡®ä¿ Jenkinsfile ä¸­ä½¿ç”¨äº†æ­£ç¡®çš„éƒ¨ç½²å‘½ä»¤ï¼š

```groovy
// æ¨èï¼šå®Œæ•´éƒ¨ç½²
sh 'bash scripts/deploy-web-to-197.sh'

// æˆ–è€…ï¼šå¿«é€Ÿéƒ¨ç½²ï¼ˆå¦‚æœæ„å»ºå·²ç»å®Œæˆï¼‰
sh 'bash scripts/deploy-web-to-197.sh --skip-build'
```

### Q: å¦‚ä½•éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸï¼Ÿ

**A:** æ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

1. **æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—**ï¼š
   ```bash
   # SSH ç™»å½•æœåŠ¡å™¨
   ssh portwin@192.168.0.197
   
   # æŸ¥çœ‹æœåŠ¡æ—¥å¿—
   pm2 logs api-gateway-web
   ```

2. **è®¿é—®å‰ç«¯**ï¼š
   ```
   http://192.168.0.197:14289
   ```

3. **æ£€æŸ¥æ–‡ä»¶**ï¼š
   ```bash
   ls -la /srv/api-proxy-admin-web/
   # åº”è¯¥çœ‹åˆ° index.html å’Œ assets ç›®å½•
   ```

## ğŸ’¡ æœ€ä½³å®è·µ

### å¼€å‘é˜¶æ®µ

```bash
# 1. ä¿®æ”¹ä»£ç åï¼Œæœ¬åœ°æµ‹è¯•
pnpm run dev:web

# 2. æµ‹è¯•é€šè¿‡åï¼Œæ„å»º
pnpm --filter @gateway/web build

# 3. å¿«é€Ÿéƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨
pnpm run deploy:web:fast
```

### ç”Ÿäº§éƒ¨ç½²

```bash
# ä½¿ç”¨å®Œæ•´éƒ¨ç½²æµç¨‹ï¼Œç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½æ˜¯æœ€æ–°çš„
pnpm run deploy
```

### CI/CD (Jenkins)

```groovy
stage('Build') {
  steps {
    sh 'pnpm install --frozen-lockfile'
    sh 'pnpm --filter @gateway/web build'
  }
}

stage('Deploy') {
  steps {
    // ä½¿ç”¨ --skip-build å› ä¸ºå‰é¢å·²ç»æ„å»ºè¿‡
    sh 'bash scripts/deploy-web-to-197.sh --skip-build'
  }
}
```

## ğŸ“Š éƒ¨ç½²æ—¶é—´å¯¹æ¯”

| æ–¹å¼ | ç¬¬ä¸€æ¬¡ | åç»­ | è¯´æ˜ |
|------|--------|------|------|
| å®Œæ•´éƒ¨ç½² | ~5 åˆ†é’Ÿ | ~3 åˆ†é’Ÿ | å®‰è£…ä¾èµ– + æ„å»º + éƒ¨ç½² |
| è·³è¿‡å®‰è£… | ~3 åˆ†é’Ÿ | ~2 åˆ†é’Ÿ | æ„å»º + éƒ¨ç½² |
| è·³è¿‡æ„å»º | ~1 åˆ†é’Ÿ | ~30 ç§’ | ä»…éƒ¨ç½² |
| **å¿«é€Ÿæ¨¡å¼** | **~30 ç§’** | **~10 ç§’** | **ä»…æ‰“åŒ…å’Œä¸Šä¼ ** âš¡ |

## ğŸ¯ æ¨èå·¥ä½œæµ

```bash
# å¼€å‘æ—¶ï¼ˆåªéœ€è¦æ„å»ºä¸€æ¬¡ï¼‰
pnpm --filter @gateway/web build

# æ¯æ¬¡ä¿®æ”¹ä»£ç å
# 1. æœ¬åœ°æµ‹è¯•
pnpm run dev:web

# 2. ç¡®è®¤æ— è¯¯åï¼Œé‡æ–°æ„å»º
pnpm --filter @gateway/web build

# 3. å¿«é€Ÿéƒ¨ç½²
pnpm run deploy:web:fast  # åªéœ€ 10-30 ç§’ï¼
```

## ğŸ”§ è„šæœ¬å‚æ•°è¯´æ˜

### deploy-web-to-197.sh

```bash
# å®Œæ•´éƒ¨ç½²ï¼ˆé»˜è®¤ï¼‰
bash scripts/deploy-web-to-197.sh

# è·³è¿‡ä¾èµ–å®‰è£…
bash scripts/deploy-web-to-197.sh --skip-install

# è·³è¿‡æ„å»º
bash scripts/deploy-web-to-197.sh --skip-build

# å¿«é€Ÿæ¨¡å¼ï¼ˆè·³è¿‡å®‰è£…å’Œæ„å»ºï¼‰
bash scripts/deploy-web-to-197.sh --fast
```

## ğŸ“ æ›´æ–°æ—¥æœŸ

2025-10-08
